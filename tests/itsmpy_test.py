import numpy as np
import pprint
from ARIMA.itsmpy import ITSM

deaths = np.array(
    [9007,8106,8928,9137,10017,10826,11317,10744,9713,9938,9161,8927,7750,
     6981,8038,8422,8714,9512,10120,9823,8743,9129,8710,8680,8162,7306,8124,
     7870,9387,9556,10093,9620,8285,8433,8160,8034,7717,7461,7776,7925,8634,
     8945,10078,9179,8037,8488,7874,8647,7792,6957,7726,8106,8890,9299,10625,
     9302,8314,8850,8265,8796,7836,6892,7791,8129,9115,9434,10484,9827,9110,
     9070,8633,9240])

deaths_pred = np.array([
     8102.42690665, 7406.04622741, 8090.47779305, 8269.22825559,
     9084.03427852, 9434.1982237, 10291.54297165, 9551.43069241,
     8435.61561997, 8756.6521224, 8221.73245091, 8388.26870837,
     7634.02502821, 6906.07984857, 7643.08836819, 7822.46140395,
     8637.29503126, 9004.52523242, 9850.30265124, 9174.60466946,
     8119.90724566, 8452.60539658, 7950.53431645, 8128.82800327,
     7409.31894995, 6713.65439023, 7439.73136927, 7623.87361156,
     8426.95839573, 8793.88900885])

aicc = -297.0827667168499

def test_itsmpy():

    itsm = ITSM()
    M = ['log', 'season', 12, 'trend', 1]
    e = itsm.Resid(deaths, M)
    warnings.filterwarnings("ignore")
    a = itsm.autofit(e)
    print('ARMA model: ')
    pprint.pprint(a, width=1)

    ee = itsm.Resid(deaths, M, a)
    f = itsm.forecast(deaths, M, a, 30)

    kkk = np.vstack((f['pred'], f['l'], f['u'])).T
    print(kkk)
    print(kkk.shape)

    assert kkk.shape == (30,3)
    assert ((deaths_pred - f['pred'])**2) < 5
    assert a['aicc'] == aicc
